---
title: "Surgical sutures"
author: "Andrew J. Sims"
date: "February 2021"
output: rmarkdown::pdf_document
bibliography: "references.bib"
csl: "bmj.csl"
---
```{r, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE
)
```

```{r setup, echo=F}
library(rdecision)
```

# Introduction
Leaper *et al* [-@leaper2017] presented a model that compared antimicrobial
surgical sutures (absorbable sutures impregnated with triclosan, TCS) with
standard care, absorbable sutures with no antimicrobial impregnation (NCS). 
The model was evaluated in three scenarios:

* clean wounds;
* clean-contaminated wounds;
* contaminated and dirty wounds

# Scenario 1: clean wounds
```{r s1-modvars}
# model inputs
c.pack.TCS <- GammaModVar$new(
  "VICRYL plus pack",
  "GBP", 
  shape = 100,            # MIB: VICRYL plus, £3.63, 10% CoV 
  scale=3.63/100
)
c.pack.NCS <- GammaModVar$new(
  "VICRYL pack", "GBP",
  shape = 100,            # MIB: VICRYL, £2.88, 10% CoV
  scale = 2.88/100
)
n.sutures <- GammaModVar$new(
  "Sutures per procedure", # Gamma is conjugate prior of Poisson mean
  "n",
  shape = 200,            # assumed 200 packs in 100 operations
  scale = 1/100
)       
p.SSI.NCS <- BetaModVar$new(
  "P(SSI | NCS)",
  "P",
  alpha = 653,            # Coello 2005, 653 small bowel SSI in 6528 ops
  beta = 6528-63
)     
rr.TCS <- LogNormModVar$new(
  "RR(SSI | TCS)", "RR",
  p1 = 0.67,              # RR reported as 0.67 (95%CI 0.53 to 0.84)
  p2 = (0.84-0.53)/(2*1.96),
  "LN7"
)        
c.SSI <- GammaModVar$new(
  "Excess cost SSI", "GBP",
  shape = 6,
  scale = 500            # assumes standard error equals mean
)
# derived parameters (expressions)
q.SSI.NCS <- ExprModVar$new(
  "1-P(SSI|NCS)", "P",
  rlang::quo(1 - p.SSI.NCS)
)
p.SSI.TCS <- ExprModVar$new(
  "P(SSI|TCS)", "P",
  rlang::quo(p.SSI.NCS * rr.TCS)
)
q.SSI.TCS <- ExprModVar$new(
  "1-P(SSI|TCS)", "P",
  rlang::quo(1 - p.SSI.TCS)
)
c.TCS <- ExprModVar$new("Cost of TCS per proedure", "GBP", 
                        rlang::quo(c.pack.TCS * n.sutures))
c.NCS <- ExprModVar$new("Cost of NCS per procedure", "GBP", 
                        rlang::quo(c.pack.NCS * n.sutures))
```

```{r s1-model}
# nodes
A <- LeafNode$new("A")
B <- LeafNode$new("B")
c1 <- ChanceNode$new()
C <- LeafNode$new("C")
D <- LeafNode$new("D")
c2 <- ChanceNode$new()
d1 <- DecisionNode$new("Suture")
# edges
e1 <- Reaction$new(c1,A,p=p.SSI.TCS,cost=c.SSI,label="SSI")
e2 <- Reaction$new(c1,B,p=q.SSI.TCS,cost=0,label="No SSI")
e3 <- Action$new(d1,c1,label="Antimicrobial",cost=c.TCS,benefit=0)
e4 <- Reaction$new(c2,C,p=p.SSI.NCS,cost=c.SSI,label="SSI")
e5 <- Reaction$new(c2,D,p=q.SSI.NCS,cost=0,label="No SSI")
e6 <- Action$new(d1,c2,label="Standard",cost=c.NCS,benefit=0)
# tree
DT1 <- DecisionTree$new(V=list(A,B,c1,C,D,c2,d1), E=list(e1,e2,e3,e4,e5,e6))
```

```{r }
caption <- "Decision tree for all scenarios."
```
```{r draw, fig.keep="last", fig.align="center", fig.width=6, fig.cap=caption}
DT1$draw(border=TRUE)
```

## The model
The decision tree defined by Leaper *et al* [-@leaper2017] is shown in figure 1. 
The model had six input variables: the probability of an SSI with NCS,
the risk ratio of an SSI with TCS compared with NCS, cost of TCS, cost of NCS,
number of sutures per surgical procedure and cost of an admission with
diagnosis of infection. The uncertainties in the estimates of the variables
were described by distributions with hyperparameters (Table 1).

```{r s1-inputs}
keep <- c("Description", "Units", "Distribution", "Mean", "Q2.5", "Q97.5")
pander::pander(
  DT1$modvar_table(expressions=FALSE)[,keep],
  caption = "Model inputs",
  justify = c("lllrrr")
)
```

## Results

### Base case
Base case is shown in the table below.
```{r clean_base}
RES <- DT1$evaluate()
keep <- c("Suture", "Cost")
pander::pander(RES[,keep])
```

### Univariate sensitivity
Tornado chart is shown in figure 2.

```{r clean_dsa}
caption <- "Tornado chart showing mean cost savings per procedure."
```
```{r tornado, fig.keep="last", fig.align="center", fig.width=6, fig.cap=caption}
TO <- DT1$tornado(index=list(e3), ref=list(e6))
```

### PSA
PSA results are shown in Figure 3.

```{r clean_psa}
caption <- "PSA results."
```
```{r fig.keep="last", fig.align="center", fig.width=6, fig.cap=caption}
local({
  PSA <- DT1$evaluate(setvars="random", N=1000)
  RES <<- reshape(PSA, idvar='Run', timevar="Suture", direction='wide')
  RES$Difference <<- RES$Cost.Standard - RES$Cost.Antimicrobial
  keep<- c('Run', 'Cost.Standard', 'Cost.Antimicrobial', 'Difference')
  hist(RES$Difference, freq=FALSE, xlab="Cost saving", ylab="Probability",
       main="", cex.axis=0.75, cex.lab=0.75)
  
})
```



# References

